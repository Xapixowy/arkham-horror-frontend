<div class="card-selector">
  <p-dropdown
    #cardDropdown
    [options]="cards()"
    optionLabel="name"
    [filter]="true"
    filterBy="name"
    [placeholder]="'_CardSelector.Select card' | transloco"
    appendTo="body"
    styleClass="full-width"
    (onChange)="onCardSelection($event, cardDropdown)"
  >
    <ng-template let-card pTemplate="item">
      <div class="card-selector__dropdown-card">
        <div class="card-selector__dropdown-card__image">
          @if (card.front_image_path) {
            <img [src]="card.front_image_path" [alt]="card.name"/>
          } @else {
            <app-img-placeholder size="4rem"/>
          }
        </div>
        <div class="card-selector__dropdown-card__name" [pTooltip]="card.name"
             [tooltipDisabled]="card.name.length <= 25">
          {{ card.name | truncate : 25 }}
        </div>
      </div>
    </ng-template>
  </p-dropdown>
  <div class="card-selector__content">
    @if (selectedCards()().length > 0) {
      <div class="card-selector__cards">
        @for (selectedCard of selectedCards()(); track $index) {
          <ng-container [ngTemplateOutlet]="selectedCardTemplate" [ngTemplateOutletContext]="{selectedCard}"/>
        }
      </div>
    } @else {
      <div class="card-selector__no-content">
        <div class="card-selector__no-content__icon">
          <ng-icon name="tablerCards"/>
        </div>
        <div class="card-selector__no-content__label">
          {{ '_CardSelector.No card selected' | transloco }}
        </div>
      </div>
    }
  </div>
</div>

<ng-template #selectedCardTemplate let-selectedCard="selectedCard">
  <p-card styleClass="p-card--card-selector">
    <div class="card-selector__card">
      <div class="card-selector__card__image">
        @if (selectedCard.card?.front_image_path) {
          <img [src]="selectedCard.card!.front_image_path" [alt]="selectedCard.card!.name"/>
        } @else {
          <app-img-placeholder size="8rem" shape="square" aspectRatio="0.65"/>
        }
      </div>
      <div class="card-selector__card__name" [pTooltip]="selectedCard.card!.name"
           [tooltipDisabled]="selectedCard.card!.name.length <= 25">
        {{ selectedCard.card!.name | truncate : 25 }}
      </div>
      <div class="card-selector__card__quantity">
        <app-button-icon-only [pTooltip]="'_Actions.Decrease' | transloco" icon="tablerMinus"
                              severity="danger"
                              (onClick)="onCardQuantityChange(selectedCard, -1)"/>
        <span class="card-selector__card__quantity__value">{{ selectedCard.quantity }}</span>
        <app-button-icon-only [pTooltip]="'_Actions.Increase' | transloco" icon="tablerPlus"
                              severity="success"
                              (onClick)="onCardQuantityChange(selectedCard, 1)"/>
      </div>
    </div>
  </p-card>
</ng-template>
